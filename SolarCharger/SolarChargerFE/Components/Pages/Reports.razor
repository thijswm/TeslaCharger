@page "/Reports"
@using SolarChargerFE.Components.Pages.ViewModel
@inherits MudComponentBase
<PageTitle>Reports</PageTitle>

@if (_loading)
{
    <MudSkeleton SkeletonType="SkeletonType.Rectangle" Width="100%" Height="60%" />
}
else
{
    <MudGrid>
        <MudItem xs="12">
            <MudCard>
                <MudCardHeader>
                    <CardHeaderContent>
                        <MudText Typo="Typo.h6">Charging Sessions</MudText>
                    </CardHeaderContent>
                </MudCardHeader>
                <MudCardContent>
                    @if (!string.IsNullOrEmpty(_loadError))
                    {
                        <MudAlert Severity="Severity.Error">@_loadError</MudAlert>
                    }
                    else
                    {
                        <MudDataGrid T="ChargeSession" Items="@_chargeSessions" Hover="true" RowClick="@OnChargeSessionClick">
                            <Columns>
                                <PropertyColumn Property="x=>x.StartDate" Title="Start Time" />
                                <PropertyColumn Property="x=>x.EndDate" Title="End Time" />
                                <PropertyColumn Property="x=>x.BatteryLevelIncreased" Title="Battery Level Increased" />
                            </Columns>
                        </MudDataGrid>
                    }
                </MudCardContent>
            </MudCard>
        </MudItem>
        @if (_selectedChargeSession != null)
        {
            <MudItem xs="12">
                <MudCard>
                    <MudCardHeader>
                        <CardHeaderContent>
                            <MudText Typo="Typo.h6">Charging Session Details</MudText>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        @if (_loadingChargeSession)
                        {
                            <MudSkeleton SkeletonType="SkeletonType.Rectangle" Width="100%" Height="60%" />
                            <MudText>Loading...</MudText>
                        }
                        else
                        {
                            @if (_powerSeries.Data.Any())
                            {
                                <MudGrid>
                                    <MudItem xs="12" sm="6">
                                        <MudTimeSeriesChart ChartSeries="_powerChart" Width="100%" Height="350px" TimeLabelSpacing="TimeSpan.FromMinutes(30)" />
                                    </MudItem>
                                    <MudItem xs="12" sm="6">
                                        <MudTimeSeriesChart ChartSeries="_currentChart" Width="100%" Height="350px" TimeLabelSpacing="TimeSpan.FromMinutes(30)" />
                                    </MudItem>
                                </MudGrid>
                            }
                            else
                            {
                                <MudText>No data available</MudText>
                            }
                        }
                    </MudCardContent>
                </MudCard>
            </MudItem>
        }
    </MudGrid>
}